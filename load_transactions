import pandas as pd

filepath = '/Users/mattray/Desktop/Budget/inputs'



def load_chase(filename):
    df = pd.read_csv(fr'/Users/mattray/Desktop/Budget/inputs/{filename}.csv')
    df = df[["Transaction Date", "Post Date", "Description",
        "Category", "Type", "Amount"]]

    df["Category"] = df["Category"].replace({
        "Food & Drink": "Leisure",
        "Shopping": "Leisure",
        "Health & Wellness": "Leisure",
        "Entertainment": "Leisure"
    })
    return df



CHECKING_CATEGORY_MAP = {
    "STATE FARM": "Insurance",
    "IDAHO POWER": "Utilities",
    "INTERMOUNTAIN": "Utilities",
    "COVENANT": "Subscriptions",
    "CHATGPT": "Subscriptions",
    "Spotify": "Subscriptions",
    "TACO": "Leisure",
    "TRADER": "Groceries",
    "Zelle¬Æ Payment to Amy Ray": "Amy's Allowance",
    "FITNESS LEGENDZ": "Subscriptions",
    "PETCO": "Pet Food",
    "NSM DBAMR.COOPER": "Mortgage",
    "ST LUKE'S HS": "Direct Deposit - Amy",
    "Clearwater A-OSV" : "Direct Deposit - Matt",
    "Zelle¬Æ Payment to Amy Bellenbaum": "Amy's Allowance"
}




def load_sofi(filename):
    df = pd.read_csv(fr'/Users/mattray/Desktop/Budget/inputs/{filename}.csv')
    df = df[["Date", "Description", "Type", "Amount"]]
    df = df[~df["Description"].str.contains("MSPBNA", case=False, na=False)]
    df = df[~df["Description"].str.contains("CHASE CREDIT CRD", case=False, na=False)]

    def map_checking_category(row):
        desc = row["Description"]
        amount = row["Amount"]

        # First: check category mappings
        for k, v in CHECKING_CATEGORY_MAP.items():
            if k.upper() in desc.upper():
                return v

        # Otherwise: classify based on amount
        if amount > 0:
            return "Other Income"
        else:
            return "Other Expense"

    df["Category"] = df.apply(map_checking_category, axis=1)
    df.loc[
        (df["Description"] == "VENMO") & (df["Amount"] > 0),
        "Category"
    ] = "Other Income"
    df.loc[
        (df["Description"] == "VENMO") & (df["Amount"] < 0),
        "Category"
    ] = "Other Expense"
    df.loc[
        (df["Description"].str.contains("Zelle")) & (df["Amount"] > 0) & (~df["Description"].str.contains("payment to amy ray", case=False, na=False)),
        "Category"
    ] = "Other Income"
    df.loc[
        (df["Description"].str.contains("Zelle")) & (df["Amount"] < 0) & (~df["Description"].str.contains("payment to amy ray", case=False, na=False)),
        "Category"
    ] = "Other Expense"

    return df

